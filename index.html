<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta charset="utf-8" />
        <title>Entel VR</title>
        <meta name="description" content="Entel VR"/>
        <!--meta name="apple-mobile-web-app-capable" content="yes"/-->

        <!--script src="js/aframe.js"></script-->
        <!--script src="js/aframe-cubemap-component.js"></script-->
        <script src="https://aframe.io/releases/0.3.1/aframe.min.js"></script>
        <script src="js/aframe-video-controls.js"></script>
        <!--script src="https://rawgit.com/oscarmarinmiro/aframe-video-controls/master/dist/aframe-video-controls.min.js"></script-->
        <!--script src="js/aframe-inspector.js"></script-->
    </head>
    <body>

        <a-scene>
            <!-- Assets management system -->
            <a-assets>

                <img id="play" src="images/play.png"/>
                <img id="home" src="images/home.png"/>
                <img id="threesixty-tower-thumbnail" src="images/360_tower_video_icon.jpg"/>
                <img id="dirt-bike-thumbnail" src="images/dirt_bike_video_icon.jpg"/>
                <img id="parachute-thumbnail" src="images/parachute_video_icon.jpg">
                <img id="entel-sky" src="images/Background.jpg"/>

                <!--TODO Check videos are working-->
                <video id="entel-video" src="videos/ENTEL_FINAL_360.mp4"/>
                <video id="dirt-bike-video" src="videos/ENTEL_VR_2.mp4"/>
                <video id="parachute-video" src="videos/ENTEL_VR_3.mp4"/>

            </a-assets>


            <!--a-curvedimage id="entel-logo" src="#dirt_bike_thumbnail" radius="30" theta-length="40" rotation="0 0 0" height="4"
                           position="0 0 4" play-video="on:click; src:#entel-video"> 
                <a-animation attribute="scale" begin="mouseenter" to="1.5 1.5 1.5"></a-animation>
                <a-animation attribute="scale" begin="mouseleave" to="1 1 1"></a-animation>
            </a-    >

            <a-curvedimage id="panda-obj" src="#360_tower_thumbnail" radius="30" theta-length="40" rotation="0 40 0" height="4"
                           position="4 0 4" play-video="on:click; src:#entel-video-2">
                <a-animation attribute="scale" begin="mouseenter" to="1.5 1.5 1.5"></a-animation>
                <a-animation attribute="scale" begin="mouseleave" to="1 1 1"></a-animation>
            </a-curvedimage>

            <a-curvedimage id="neo-obj" src="#parachute_thumnail" radius="30" theta-length="40" rotation="0 80 0" height="4"
                           position="4 0 0" play-video="on:click; src:#entel-video-3">
                <a-animation attribute="scale" begin="mouseenter" to="1.5 1.5 1.5"></a-animation>
                <a-animation attribute="scale" begin="mouseleave" to="1 1 1"></a-animation>
            </a-curvedimage-->

            <a-entity position="-10 5 0" rotation="0 90 0">
                <a-image id="dirt-bike" src="#dirt-bike-thumbnail" position="-8 0 0" scale="3 4.8 1"
                            play-video="on:click; src:#dirt-bike-video"></a-image>
                <a-image id="threesixty-tower" src="#threesixty-tower-thumbnail" position="0 -5 0" scale="7.2 3 1"
                             play-video="on:click; src:#entel-video"></a-image>   
                <a-image id="parachute" src="#parachute-thumbnail" position="8 0 0" scale="3 4.8 1"
                             play-video="on:click; src:#parachute-video"></a-image>
            </a-entity>

            <a-videosphere id="video-player" material="" geometry="" scale="" position="" rotation="" visible=""></a-videosphere>

            <!-- Camera -->
            <!-- TODO Fusing not working -->
            <a-entity id="camera_wrapper" rotation="0 90 0" position="0 0 0">
                <a-camera look-controls>
                    <a-cursor id="cursor" cursor="fuse: false; maxDistance: 500; timeout: 3000"></a-cursor>
                </a-camera>
            </a-entity>

            <!--a-entity id=cubemap cubemap="folder: /images/skybox/"></a-entity-->

            <!--a-entity id=playback-controls visible="false"></a-entity-->

            <!--a-image id=back src="#back" visible="false"></a-image-->

            <a-entity id="menu" visible="false">
                <a-image id="play" src="#play" position="-2.5 0 0" width=2 height=2></a-image>
                <a-image id="home" src="#home" position="2.5 0 0" width=2 height=2></a-image>
            </a-entity>

            <a-sky src="#entel-sky"></a-sky>

        </a-scene>
        <!--script src="js/aframe-inspector.js"></script-->


        <script>
            var scene = document.querySelector('a-scene');
            <!-- Shows full screen videos -->
            var videoSphereEl = document.querySelector('a-videosphere');
            //var skyboxObj = document.querySelector('a-entity#cubemap'); 
            var skyboxObj = document.querySelector('a-sky');
            //var playbackEl = document.querySelector('a-entity#playback-controls');
            //var backButton = document.querySelector('a-image#back');
            var playButton = document.querySelector('a-image#play');
            var homeButton = document.querySelector('a-image#home');
            var menuButton = document.querySelector('a-entity#menu');
            var cameraWrapper = document.querySelector('a-entity#camera_wrapper');

            var entelVideoEl = document.querySelector('a-image#threesixty-tower');
            var dirtBikeVideoEl = document.querySelector('a-image#dirt-bike');
            var parachuteVideoEl = document.querySelector('a-image#parachute');



            // click-listener component to pass window clicks to an entity.
            AFRAME.registerComponent('click-listener', {
                init: function () {
                    var el = this.el;
                    window.addEventListener('click', function () {
                        el.emit('click', null, false);
                    }); 
                }
            });


            // Play video component
            AFRAME.registerComponent('play-video', {
                schema: {
                    on: { default: 'click' },
                    src: { default: '' }, 
                },

                tick: function() {

                },

                enable_menu: function() {
                    a = document.querySelector('a-camera');
                    var s = a.object3D.getWorldDirection().projectOnPlane(new THREE.Vector3(0, 1, 0)).setLength(8);
                    menuButton.object3D.position.copy(a.object3D.getWorldPosition().sub(s)), menuButton.object3D.lookAt(a.object3D.getWorldPosition());
                    menuButton.setAttribute('visible', 'true');
                },

                disable_menu: function() {
                    menuButton.setAttribute("visible", "false");
                },

                start_video: function() {
                    this.disable_menu();
                    this.videoEl.play();
                },

                init: function() {
                    homeButton.addEventListener('click', this.showHomeScreen.bind(this));
                    playButton.addEventListener('click', this.start_video.bind(this));
                    this.videoEl = document.querySelector(this.data.src);
                    this.videoEl.addEventListener("ended", this.enable_menu.bind(this));
                    this.el.addEventListener(this.data.on, this.showFullScreenVideo.bind(this));
                },

                /**
                * Add event listener.
                */
                update: function (oldData) {

                },

                showFullScreenVideo: function() {
                    this.hideHomeScreen();
                    videoSphereEl.setAttribute('src', this.data.src);
                    videoSphereEl.setAttribute('visible', 'true');
                    //playbackEl.setAttribute('video-controls', {src:this.data.src, size:10, distance:10});
                    //playbackEl.setAttribute('visible', 'true');
                    this.videoEl.play();
                },

                hideHomeScreen: function() {
                    /*var children = document.querySelectorAll('a-image');
                    for(var i=0; i<children.length; i++) {
                        children[i].setAttribute('visible', 'false');
                    }*/
                    entelVideoEl.setAttribute('visible', 'false');
                    dirtBikeVideoEl.setAttribute('visible', 'false');
                    parachuteVideoEl.setAttribute('visible', 'false');

                    skyboxObj.setAttribute('visible', 'false');
                },

                showHomeScreen: function() {
                    cameraWrapper.setAttribute('rotation', '0 -120 0');
                    this.disable_menu();
                    videoSphereEl.removeAttribute('src');
                    videoSphereEl.setAttribute('visible', 'false');
                    /*var children = document.querySelectorAll('a-image');
                    for(var i=0; i<children.length; i++) {
                        children[i].setAttribute('visible', 'true');
                    }*/
                    entelVideoEl.setAttribute('visible', 'true');
                    dirtBikeVideoEl.setAttribute('visible', 'true');
                    parachuteVideoEl.setAttribute('visible', 'true');

                    skyboxObj.setAttribute('visible', 'true');

                }

            });
        </script>


    </body>
</html>